令牌桶模式
原理


令牌桶的

桶中保存有令牌, 存在上限, 且一开始是满的
每次请求都要消耗令牌(可根据不同请求消耗不同数量的令牌)
每隔一段时间(固定速率)会往桶中放令牌
桶的实现还分为:

可预消费

提前预支令牌数: 前人挖坑, 后人跳
不可预消费

令牌数不够直接拒绝

令牌桶的关键是以下几个参数:

桶最大容量
每次放入的令牌数
放入令牌的间隔时间
令牌桶的实现不会出现计数器模式中单位时间内双倍流量的问题.

redis-cli --eval ~/go/src/dev/redis-lua/limit/limit2_fun/limit.lua limit_fun_127.0.0.1 , 10 5 2 1580557271